var isFloatBtnDragging=0;class FloatBtnMenu{options={enabled:!0,btnId:"floatBtn",containerId:"floatBtnContainer"};constructor(e){e&&Object.keys(e).length>0&&(this.options=Object.assign(this.options,e)),this.init(),this.formHtml=`
    <div class="layui-form layui-form-pane" lay-filter="filter-test-layer" style="margin: 16px;">
      <form class="layui-form" id="configMenu" lay-filter="config-menu-layer" action="">
        <div class="layui-col-xs6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label">鼠标爱心</label>
            <div class="layui-input-block">
              <input type="radio" lay-filter="mouseHeart-radio" id="mouseHeart-radio-close" name="mouseHeart" value="0" title="关" checked>
              <input type="radio" lay-filter="mouseHeart-radio" id="mouseHeart-radio-on" name="mouseHeart" value="1" title="开">
            </div>
          </div>
        </div>
        <div class="layui-col-xs6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label">鼠标尾巴</label>
            <div class="layui-input-block">
              <input type="radio" lay-filter="mouseTail-radio" id="mouseTail-radio-close" name="mouseTail" value="0" title="关" checked>
              <input type="radio" lay-filter="mouseTail-radio" id="mouseTail-radio-on" name="mouseTail" value="1" title="开">
            </div>
          </div>
        </div>
        <div class="layui-col-xs6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label">鼠标烟花</label>
            <div class="layui-input-block">
              <input type="radio" lay-filter="firework-radio" id="firework-radio-close" name="firework" value="0" title="关" checked>
              <input type="radio" lay-filter="firework-radio" id="firework-radio-on" name="firework" value="1" title="开">
            </div>
          </div>
        </div>
        <div class="layui-col-xs6 layui-col-md6">
          <div class="layui-form-item">
             <label class="layui-form-label">看板娘模型</label>
             <div class="layui-input-block">
                <select id="live2dModelSelect" name="live2dModel" lay-verify="required" lay-search >
                  <option value="">直接选择或搜索选择</option>
                  <option value="0" selected>Diana</option>
                  <option value="1">Ava</option>
                  <option value="2">小云</option>
                </select>
              </div>
            </div>
        </div>
        <div class="layui-col-xs6 layui-col-md12">
          <div class="layui-form-item">
            <label class="layui-form-label">看板娘</label>
            <div class="layui-input-block">
              <input type="radio" lay-filter="live2d-radio-filter" name="live2d" value="0" title="隐藏" checked>
              <input type="radio" lay-filter="live2d-radio-filter" name="live2d" value="1" title="显示">
              <input type="radio" lay-filter="live2d-radio-filter" name="live2d" value="2" title="关闭">
            </div>
          </div>
        </div>
        <div class="layui-col-xs6 layui-col-md12">
          <div class="layui-form-item">
            <label class="layui-form-label">主题</label>
            <div class="layui-input-block">
              <input type="radio" name="theme" value="0" title="白天" checked>
              <input type="radio" name="theme" value="1" title="夜间">
              <input type="radio" name="theme" value="2" title="跟随系统">
            </div>
          </div>
        </div>
        <div class="layui-form-item layui-text-center">
          <button type="submit" class="layui-btn" lay-submit lay-filter="save-config">保存</button>
          <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </form>
  </div>
    `}init(){this.options.enabled&&(this.createElement(),this.initFloatBtnEvent(),this.initMenuInfo(),this.buttonsClick())}createElement(){let e=document.createElement("div");e.id=this.options.containerId,e.classList.add("floatTools");let t="";t+=`
        <div class="float-item setting" id="float-btn-setting" title="设置">
          <i class="fa-solid fa-gear"></i>
        </div>
        <div class="float-item top" id="float-btn-top" title="返回顶部">
          <i class="fa-solid fa-circle-chevron-up"></i>
        </div>
        <div class="float-item bottom" id="float-btn-bottom" title="跳转底部">
          <i class="fa-solid fa-circle-chevron-down "></i>
        </div>

        <div class="float-item content" id="float-btn-content" title="目录">
          <i class="fa-solid fa-list "></i>
        </div>

        <div class="float-item theme" id="float-btn-theme" title="主题切换">
           <i id="float-btn-theme-i" class="fas fa-solid fa-sun "></i>
         </div>
        <div class="float-item span-num" >
            <span id="float-btn-bottom-num">0%</span>
        </div>
       `,e.innerHTML=t,document.body.appendChild(e)}buttonsClick(){let e=document.getElementById("float-btn-top"),t=document.getElementById("float-btn-bottom"),i=document.getElementById("float-btn-theme"),l=document.getElementById("float-btn-content");e.onclick=()=>{if(1==isFloatBtnDragging)return;isFloatBtnDragging=2;let e=document.getElementById("write");e&&e.scrollIntoView({behavior:"smooth"}),isFloatBtnDragging=0},l.onclick=()=>{1!=isFloatBtnDragging&&(isFloatBtnDragging=2,window?.ymcEventBus.emit("changeContent"),isFloatBtnDragging=0)},t.onclick=()=>{if(1==isFloatBtnDragging)return;isFloatBtnDragging=2;let e=document.getElementById("my-bottom"),t=document.getElementById("write");if(t&&!e){if(t){let i=document.createElement("div");i.id="my-bottom",t.appendChild(i)}}else t&&e&&e.scrollIntoView({behavior:"smooth",block:"start"});isFloatBtnDragging=0};let o=document.getElementById("float-btn-theme-i");if(o){let a=e=>{0==e.darkModel?(o.classList.remove("fa-moon"),o.classList.contains("fa-sun")||o.classList.add("fa-sun")):(o.classList.remove("fa-sun"),o.classList.contains("fa-moon")||o.classList.add("fa-moon"))};window?.ymcEventBus.on("changeThemeFloatCallBack",a),i.onclick=()=>{if(1==isFloatBtnDragging||!o)return;isFloatBtnDragging=2;let e=0;e="dark"===document.documentElement.getAttribute("theme-mode")?0:1,window?.ymcEventBus.emit("changeTheme",e),isFloatBtnDragging=0}}let n=document.getElementById("float-btn-bottom-num"),s=ymcFun.throttleFun(e=>{if(!n)return;let t=document.body.scrollHeight-window.innerHeight,i=Math.round(Math.min(100*window.scrollY/t,100))+"%";n!==i&&(n.innerText=i)},100);e&&n&&document.addEventListener("scroll",s)}initMenuInfo(){var e=layui.$,t=layui.layer,i=layui.form;let l=document.getElementById("float-btn-setting");l.onclick=()=>{if(1==isFloatBtnDragging)return;isFloatBtnDragging=2;let l=t.open({type:1,area:["650px","350px"],resize:!0,shadeClose:!0,title:"组件配置",content:this.formHtml,success:function(){i.render();let o=JSON.parse(localStorage.getItem("configMenu")),a=o&&Object.keys(o).length>0,n=localStorage.getItem("darkModel")||0,s=localStorage.getItem("syncSysThemeMode")||0;n=s&&0!=s?2:n;let r=0==sessionStorage.getItem("posterGirl")?0:1;r=0==localStorage.getItem("showLive2d")?2:r;let d=localStorage.getItem("live2dModel");var m=null;(m=o&&Object.keys(o).length>0?i.val("config-menu-layer",{mouseHeart:o.mouseHeart||0,mouseTail:o.mouseTail||0,firework:o.firework||0,live2dModel:d||0,live2d:r,theme:n||0}):i.val("config-menu-layer",{mouseHeart:0,mouseTail:0,firework:0,live2dModel:d||0,live2d:r,theme:n||0}))?.mouseHeart&&1==m.mouseHeart?e("#firework-radio-on").prop("disabled",!0):e("#firework-radio-on").prop("disabled",!1),i.render("select"),m?.firework&&1==m.firework?e("#mouseHeart-radio-on").prop("disabled",!0):e("#mouseHeart-radio-on").prop("disabled",!1),m?.live2d&&1==m.live2d?e("#live2dModelSelect").prop("disabled",!1):e("#live2dModelSelect").prop("disabled",!0),i.render("radio"),i.on("radio(live2d-radio-filter)",function(t){1==t.elem.value?e("#live2dModelSelect").prop("disabled",!1):e("#live2dModelSelect").prop("disabled",!0),i.render("select")}),i.on("radio(mouseHeart-radio)",function(t){1==t.elem.value?(e("#firework-radio-on").prop("disabled",!0),e("#firework-radio-close").prop("checked",!0)):e("#firework-radio-on").prop("disabled",!1),i.render("radio")}),i.on("radio(firework-radio)",function(t){1==t.elem.value?(e("#mouseHeart-radio-on").prop("disabled",!0),e("#mouseHeart-radio-close").prop("checked",!0)):e("#mouseHeart-radio-on").prop("disabled",!1),i.render("radio")}),i.on("submit(save-config)",function(e){var i=e.field;return i&&localStorage.setItem("configMenu",JSON.stringify(i)),a&&o.mouseHeart==i.mouseHeart||(1==i.mouseHeart?window?.ymcEventBus.emit("onMouseHeart"):window?.ymcEventBus.emit("removeMouseHeart")),a&&o.firework==i.firework||(1==i.firework?window?.ymcEventBus.emit("onFirework"):window?.ymcEventBus.emit("removeFirework")),a&&o.mouseTail==i.mouseTail||(1==i.mouseTail?window?.ymcEventBus.emit("onMouseTail"):window?.ymcEventBus.emit("removeMouseTail")),a&&o.live2d==i.live2d||(1==i.live2d?window?.ymcEventBus.emit("onLive2d",i.live2dModel):0==i.live2d?window?.ymcEventBus.emit("removeLive2d"):2==i.live2d&&window?.ymcEventBus.emit("stopLive2d")),a&&o.theme==i.theme&&(2!=i.theme||1!=s)||(2==i.theme?window?.ymcEventBus.emit("syncSysTheme"):window?.ymcEventBus.emit("changeTheme",i.theme)),1==i.live2d&&o.live2dModel!=i.live2dModel&&1==o.live2d&&window?.ymcEventBus.emit("changeLive2dModel",i.live2dModel),t.msg("保存成功",{icon:1,time:2e3},function(){t.close(l)}),isFloatBtnDragging=0,!1})},end:function(){isFloatBtnDragging=0}})}}initFloatBtnEvent(){let e=document.getElementById(this.options.containerId);e&&(e.addEventListener("mousedown",function t(i){var l={x:i.clientX-this.offsetLeft,y:i.clientY-this.offsetTop};function o(t){if(t.preventDefault(),2!=isFloatBtnDragging){isFloatBtnDragging=1;let i=t.clientX-l.x;i<0?i=0:i>=window.innerWidth-e.offsetWidth&&(i=window.innerWidth-e.offsetWidth),e.style.left=i+"px",e.style.top=t.clientY-l.y+"px",e.style.bottom="auto"}}function a(t){1==isFloatBtnDragging&&(e.offsetTop+e.clientHeight>=window.innerHeight?e.style.top=window.innerHeight-e.clientHeight+"px":e.offsetTop<=20?e.style.top="10px":e.style.top=e.offsetTop+"px"),e.removeEventListener("mousemove",o),e.removeEventListener("mouseup",a)}isFloatBtnDragging=0,e.addEventListener("mousemove",o),e.addEventListener("mouseup",a)}),e.addEventListener("mouseover",function(){e.style.opacity=1}),e.addEventListener("mouseout",function(){e.style.opacity=.75}),document.addEventListener("resize",ymcFun.throttleFun(function(){e.style.left="5px"}),50))}}