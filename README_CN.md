<div align="right"><a title="Chinese" href="./README_CN.md">ä¸­æ–‡</a> | <a title="Chinese" href="./README.md">English</a></div>

### ğŸ‰ é¡¹ç›®å¤‡æ³¨
é¡¹ç›®ï¼šymc_typora   
ä½œè€…ï¼šshaw  
è¯­è¨€ï¼šJavaScript && CSS  
æ—¶é—´ï¼š2022.03.15 ~ è‡³ä»Š  
æ¡ˆä¾‹:  https://jtcymc.github.io/ymc_typora/
# ymc_typora

<img src="https://cdn.jsdelivr.net/gh/jtcymc/ymc_typora@latest/docs/imgs/theme-shaw.png" style="zoom:80%;" alt="theme-shaw" />


åŸºäº [drake-juejin](https://github.com/liangjingkanji/DrakeTyporaTheme) å’Œ [drake-juejin](https://github.com/liangjingkanji/DrakeTyporaTheme) ä¸»é¢˜ã€‚


## ğŸ’» å®‰è£…


### GIT


> å¦‚æœæ‚¨ä½äºä¸­å›½å¤§é™†ï¼Œå¯ä»¥ä» [Gitee](*https://gitee.com/shawymc/ymc_typora.git*) ä¸‹è½½


ä¸»è¦åˆ†æ”¯ [æ¨è]:


```bash
  git clone -b master https://gitee.com/shawymc/ymc_typora.git ymc_typora
```


### ä¸»é¢˜
å°†ä¸»é¢˜æ–‡ä»¶å¤åˆ¶åˆ° Typora ä¸»é¢˜æ–‡ä»¶å¤¹ä¸­ï¼š


```text
  {Typora å®‰è£…æ ¹ç›®å½•}\themes
```


### Typora æ‰©å±•
æ‰¾åˆ° `{Typora å®‰è£…æ ¹ç›®å½•}\resources\window.html` ï¼Œæœç´¢ `id="write"` å¹¶è¿›å…¥ `<div id="write" class="ty-before-first-render" contenteditable="false" spellcheck="true" tabindex="-1">` ï¼Œä¹‹å‰æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
```html
  <script src="https://cdn.jsdelivr.net/gh/jtcymc/ymc_typora@latest/js/autoload-shaw-page-component.min.js"></script>
```


## âš™ é…ç½®ä¸ä½¿ç”¨
1. æ‰“å¼€æˆ–é‡æ–°å¯åŠ¨ Typoraã€‚å•å‡» `Themes` åˆ‡æ¢åˆ° `shaw-light`
2. åœ¨ `æ–‡ä»¶` -> `åå¥½è®¾ç½®` -> `å¯¼å‡º` ==> `HTML` ==> `åœ¨<head/>ä¸­æ·»åŠ `ï¼š
```html
  <script src="https://cdn.jsdelivr.net/gh/jtcymc/ymc_typora@latest/js/autoload-shaw-page-component.min.js"></script>
```



## ğŸ‰ ç‰¹ç‚¹
- [x] å·¥å…·æ ï¼š
    - [x] è¿”å›é¡¶éƒ¨ã€‚
    - [x] è·³è½¬åˆ°åº•éƒ¨ã€‚
    - [x] åˆ‡æ¢æµ…è‰²ğŸ”† / æ·±è‰²ğŸŒ’ä¸»é¢˜ã€‚
    - [x] æ›´æ”¹ Live2d æ¨¡å‹ã€‚
    - [x] å±•å¼€æˆ–æ”¶èµ·ç›®å½•ã€‚
- [x] Live2d
- [x] å›¾åƒæ‡’åŠ è½½ã€‚*. ä»…æ”¯æŒå¯¼å‡º`HTML`ã€‚
- [x] `iframe`æ‡’åŠ è½½ã€‚*. ä»…æ”¯æŒå¯¼å‡º`HTML`ã€‚
- [x] å›¾åƒä½¿ç”¨ Fasxboxã€‚*. ä»…æ”¯æŒå¯¼å‡º`HTML`ã€‚
- [x] æ‚¬æµ®æŒ‰é’®è®¾ç½®ï¼š
    - [x] é¼ æ ‡ç‚¹å‡»æ•ˆæœ `heart`ã€‚
    - [x] é¼ æ ‡ç‚¹å‡»æ•ˆæœ `firework`ã€‚
    - [x] é¼ æ ‡æ‹–å°¾ç‰¹æ•ˆã€‚
    - [x] Live2d è®¾ç½®ã€‚åŒ…æ‹¬æ¨¡å‹é€‰æ‹©å’Œå¼€å…³ã€‚
    - [x] æµ…è‰²ğŸ”† / æ·±è‰²ğŸŒ’ä¸»é¢˜æ›´æ”¹å’ŒåŒæ­¥ç³»ç»Ÿä¸»é¢˜ã€‚
- [x] å…¶ä»–......

## demo



 <iframe src="https://jtcymc.github.io/ymc_typora/" style="width:100%;height:700px;border: 1px solid"/>



## ğŸ“· å±å¹•æˆªå›¾

<img src="https://cdn.jsdelivr.net/gh/jtcymc/ymc_typora@latest/docs/imgs/shaw-light.png" style="zoom:80%;" alt="shaw-light" />





â€‹			<img src="https://cdn.jsdelivr.net/gh/jtcymc/ymc_typora@latest/docs/imgs/shaw-dark.png" style="zoom:80%;" alt="shaw-dark" />


â€‹			<img src="images/README_CN/float-btn.png" style="zoom:100%;border: 1px solid" alt="float-btn" />



## é…ç½®æ•™ç¨‹
### å›¾é‡Š
#### Typoraç¼–è¾‘é¡µæœ‰æ•ˆ



ç›®å‰ä¼šå¯¹å›¾ç‰‡è‡ªåŠ¨ç¼–å·ï¼Œä½†è¦æ­£ç¡®æ˜¾ç¤ºå›¾é‡Šï¼ˆ`alt`å±æ€§å€¼ï¼‰ï¼Œè¿˜éœ€é¢å¤–ä¿®æ”¹<u>frame.js</u>æºç ï¼ˆåœ¨å®‰è£…è·¯å¾„<span alt="str">Typora/resources/appsrc/window</span>ä¸‹ï¼‰ï¼Œåˆ†åˆ«å®šä½åˆ°`class='md-image md-img-loaded"+w+"' "+b+"><span class='md-meta md-before md-content' contenteditable='true'>"+h+"</span>"+`ä»¥åŠ`contenteditable='false' class='md-image"+L+"' data-src='"+k+"' "+b+"><span class='md-meta md-before md-content' contenteditable='true'>"+h+"</span>"+`å¤„ï¼ˆæ³¨æ„Typoraç‰ˆæœ¬ä¸åŒï¼Œç›¸å…³ä»£ç å¯èƒ½æœ‰æ‰€åŒºåˆ«ï¼‰ï¼Œå°†ä¸¤å¤„æœ«å°¾éƒ½åé¢æ›¿æ¢ä¸ºä»¥ä¸‹å­—ç¬¦ä¸²å³å¯ï¼š

```js
"<span class='CustomImg' alt='"+ F.getAttribute("alt")+"'>" +F.outerHTML+"</span></span>"
```

<img src="https://cdn.jsdelivr.net/gh/jtcymc/ymc_typora@latest/docs/imgs/image-20230429153541789.png" style="zoom:80%;" alt="pageInfo" />



#### å¯¼å‡ºhtmlæ”¯æŒå›¾é‡Š

typoraä¸»é¢˜è®¾ç½®

```css
/* å¯¼å‡ºæ—¶æ‰ä¼šå±•ç¤ºï¼Œé¿å…å› imgæ ‡ç­¾å¯¼è‡´çš„ä¸ç”Ÿæ•ˆé—®é¢˜ */
#write p:has(img):not(.md-end-block)::after {
  counter-increment: imgNum;
  content: "å›¾" counter(imgNum) " " attr(alt) !important;
  text-align: center;
  width: 100%;
  margin-top: 8px !important;
  font-size: small;
  display: inline-block;
}
```



JS <a href="extend/js/ui/shaw-typora-expend.js"> shaw-typora-expend.js</a>

```javascript
/**
 * ä½¿ç”¨JSå®ç° ç»™æ‰€æœ‰ <p><img/></p> ä¸­çš„pæ·»åŠ altå±æ€§ï¼Œpçš„altå€¼æ¥æº imgçš„alt
 * ä¸ºäº†å®ç°å¯¼å‡ºçš„å›¾è§£é‡Š
 */

function shaw_img_alt_to_p_label() {
    // è·å–æ‰€æœ‰çš„ <p><img/></p> å…ƒç´ 
    const paragraphs = document.querySelectorAll('p > img');
    paragraphs.forEach(img => {
        const parent = img.parentElement;
        const alt = img.getAttribute('alt');
        const pAlt = parent.getAttribute('alt');
        if (parent && alt && !pAlt) {
            // æ·»åŠ  alt å±æ€§åˆ°çˆ¶å…ƒç´  p ä¸Š
            parent.setAttribute('alt', ". " + alt);
        }
    });
}

window.addEventListener('load', function () {
    shaw_img_alt_to_p_label();
});
```
### å¯¼å‡ºhtmlæ”¯æŒå›¾ç‰‡å’Œiframeæ‡’åŠ è½½

#### typora éƒ¨åˆ†ä¿®æ”¹

æ‰¾åˆ°`{typoraå®‰è£…è·¯å¾„}\resources\appsrc\window\frame.js`   æœç´¢`async exportAndSaveHTML(e)` åœ¨  `var n = await this.exportToHTML(e);` åé¢æ·»åŠ  å¦‚ä¸‹ä»£ç ï¼š

```javascript
var regex = /<p[^>]*>\s*<img([^>]+)src=([^>\s]+)(.*?)>\s*<\/p>/gi;
n = n.replace(regex, '<p><img$1data-src=$2$3></p>');
```



å®Œæ•´ä»£ç ï¼š<a href="extend/js/ui/shaw-typora-expend.js"> shaw-typora-expend.js</a>

```javascript
async exportAndSaveHTML(e) {
    var t = await p.showExportDialog("html", e);
    if (t) {
        this.recordLastExport(e, t);
        var n = await this.exportToHTML(e);
        // ===========================æ·»åŠ ä»£ç ============start===========================
        var regex = /<p[^>]*>\s*<img([^>]+)src=([^>\s]+)(.*?)>\s*<\/p>/gi;
        n = n.replace(regex, '<p><img$1data-src=$2$3></p>');
        //n = n.replace(/<iframe src=/g, "<iframe data-src="); // 2023/07/08 æ·»åŠ iframeæ‡’åŠ è½½
        var iframeRegx = /(<iframe\s+[^>]*)(\bsrc\s*=\s*["']?([^>"' ]+)\s*["']?)([^>]*>)/g;
        n = n.replace(iframeRegx, `$1 data-src="$3"$4`); // 2023/07/15
        // ===========================æ·»åŠ ä»£ç ============end===========================
        File.fs.writeFile(t, n, n => {
            n ? (c.showDialog({
                title: m.localize.getString("Error"),
                html: m.localize.getString("Failed to export file to <em>{0}</em>", "Panel").format(a.escape(t)) + "<br/>" + a.escape(n.message),
                backdrop: "static",
                type: "error"
            }), console.sendError(n, "warn")) : w("html", t, e)
        })
    }
}
```



#### æ‡’åŠ è½½ä»£ç 

```javascript
/***
 * ä¼˜åŒ–Typoraå¯¼å‡ºï¼Œå›¾ç‰‡å®ç°æ‡’åŠ è½½
 */

async function lazyLoadImg(img) {
  const intersectionObserver = new IntersectionObserver(
    (entries) => {
      if (entries[0].isIntersecting) {

        const src_tmp = img.getAttribute('data-src');
        // å›¾ç‰‡è¿›å…¥å¯è§†åŒºåŸŸï¼ŒåŠ è½½å›¾ç‰‡
        // å…ˆä¿å­˜åŸå§‹çš„ srcï¼ŒåŠ è½½åå†æ›¿æ¢ã€‚
        const originalSrc = src_tmp ? src_tmp : "https://hnt-oss.oss-cn-chengdu.aliyuncs.com/js/ui/Not-find-img.png";
        img.onload = () => {
          // å›¾ç‰‡åŠ è½½å®Œæˆåç§»é™¤è§‚å¯Ÿå™¨
          intersectionObserver.disconnect();
        };
        img.src = originalSrc;
      }
    },
    { threshold: 0.01 }
  );
  intersectionObserver.observe(img);
}

/**
 * iframe æ‡’åŠ è½½
 * @param iframeTag
 */
async function lazyLoadIframe(iframeTag) {
  const intersectionObserver = new IntersectionObserver(
    (entries) => {
      if (entries[0].isIntersecting) {
        const src_tmp = iframeTag.getAttribute("data-src");
        // å›¾ç‰‡è¿›å…¥å¯è§†åŒºåŸŸï¼ŒåŠ è½½å›¾ç‰‡
        // å…ˆä¿å­˜åŸå§‹çš„ srcï¼ŒåŠ è½½åå†æ›¿æ¢ã€‚
        iframeTag.onload = () => {
          // å›¾ç‰‡åŠ è½½å®Œæˆåç§»é™¤è§‚å¯Ÿå™¨
          intersectionObserver.disconnect();
        };
        iframeTag.src = src_tmp;
      }
    },
    { threshold: 0.01 }
  );
  intersectionObserver.observe(iframeTag);
}

function initLazyLoad() {
  const imgs = document.querySelectorAll("p img[data-src]");
  imgs.forEach((img) => {
    lazyLoadImg(img);
  });
	 // 2023/07/08 æ·»åŠ iframeæ‡’åŠ è½½ start
  const iframeTags = document.querySelectorAll("iframe[data-src]");
  iframeTags.forEach((tag) => {
    lazyLoadIframe(tag);
  });
  // 2023/07/08 æ·»åŠ iframeæ‡’åŠ è½½ end
}

window.addEventListener('load', initLazyLoad);
```

